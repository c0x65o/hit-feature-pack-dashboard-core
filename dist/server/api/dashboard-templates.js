// API: /api/dashboard-templates
//
// This endpoint exposes the app-local compiled template registry:
// - applications/<app>/.hit/generated/dashboard-templates.json
//
// The registry is generated by `hit run` by scanning enabled feature packs for:
// - dashboards/templates/*.json
// - dashboards/*.json
//
// Dashboard-core stays generic: it reads the registry and can offer “install/copy” UX.
import { NextResponse } from 'next/server';
import fs from 'node:fs';
import path from 'node:path';
export const dynamic = 'force-dynamic';
export const runtime = 'nodejs';
function loadRegistry(projectRoot) {
    try {
        const p = path.join(projectRoot, '.hit', 'generated', 'dashboard-templates.json');
        if (!fs.existsSync(p))
            return null;
        const raw = fs.readFileSync(p, 'utf8');
        return JSON.parse(raw);
    }
    catch {
        return null;
    }
}
export async function GET(request) {
    const { searchParams } = new URL(request.url);
    const pack = String(searchParams.get('pack') || '').trim();
    const projectRoot = process.cwd();
    const reg = loadRegistry(projectRoot);
    const templates = Array.isArray(reg?.templates) ? reg.templates : [];
    const filtered = pack ? templates.filter((t) => String(t?.packName || '').trim() === pack) : templates;
    return NextResponse.json({ templates: filtered });
}
